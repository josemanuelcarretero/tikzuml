\documentclass[a4paper,11pt]{report}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc} % police encodee en UTF-8 %
\usepackage[french]{babel} % police fr %
\usepackage{graphicx} % pour inclusion d'images %
\usepackage{pgf} % pour dessiner %
\usepackage{tikz} % pour dessiner %
\usepackage{xcolor} % definition des couleurs %	
\usepackage[plainpages=false,pdfpagelabels,bookmarksnumbered,breaklinks=true]{hyperref} % pour les references %
\usepackage{amsmath} % pour les formules de maths %
\usepackage{latexsym} % pour les symboles maths %
\usepackage{amssymb} % pour les symboles maths %
\usepackage{aeguill} % pour les guillemets et accents francais %
\usepackage{listings} % pour les listings de code %
\usepackage{helvet} % police helvetica %
\usepackage{../tikz-uml} % pour les diagrammes de classe

\newif\iffinal % definit un switch entre brouillon et version final
%\finaltrue % a utiliser pour compiler le document en version finale

\iffinal
  \newcommand{\inputTikZ}[1]{%
    \input{fig/#1.tikz}%
  }%
  \hypersetup{%
    pdftitle={TikZ-UML},%
    pdfauthor={N. Kielbasiewicz},%
    pdfpagemode=UseOutlines,%
    linkbordercolor=0 0 0,%
    linkcolor=black,%
    citecolor=black,%
    colorlinks=true%
  }%
\else
  %\usepackage{showlabels}%
  \newcommand{\inputTikZ}[1]{%
    \includegraphics{fig/#1.pdf}%
  }%
  \hypersetup{%
    pdftitle={TikZ-UML},%
    pdfauthor={N. Kielbasiewicz},%
    pdfpagemode=UseOutlines,%
    linkbordercolor=0 0 0,%
    linkcolor=red,%
    citecolor=blue,%
    colorlinks=true%
  }%
\fi

% modification des dimensions de la page et de son centrage %
%\pagestyle{empty} % page brute %
\textwidth 17.5cm
\textheight 24.5cm
\hoffset=-2.4cm % position du point en haut {\`a} gauche %
\voffset=-1.9cm % position du point en haut {\`a} gauche %
%\itemsep -0.15cm % pour les listes %
%\parindent=1cm % pour les paragraphes %

% pour la justification a gauche et a droite et l'occupation maximale de l'espace dispo %
\sloppy
\hyphenpenalty 10000000

%\pagestyle{fancy} % on va mettre en tete et pied de page %
% \cfoot{\thepage}

%\fancypagestyle{plain}{%
%  \fancyhf{}
%  \fancyfoot{}
%  \renewcommand\headrulewidth{0pt}
%  \renewcommand\footrulewidth{0pt}
%}

%\fancyhead[RE,LO]{\leftmark}
%\fancyhead[RO,LE]{\thepage}
%\fancyfoot{}

\def\figureautorefname{figure}%
\def\tableautorefname{tableau}%
\def\partautorefname{partie}%
\def\chapterautorefname{chapitre}%
\def\appendixautorefname{annexe}%
\def\sectionautorefname{section}%
\def\subsectionautorefname{sous-section}%
\def\subsubsectionautorefname{paragraphe}%

\newcommand{\clearemptydoublepage}{\newpage{\pagestyle{empty}\cleardoublepage}}
\newcommand{\remarque}[1]{\begin{tikzpicture} \draw (0,0) node[regular polygon, regular polygon sides=3, draw, thick] {} node {\bf !};\end{tikzpicture} #1}

% redefinitions necessaires si inclusion du package marvosym
%\renewcommand{\Rightarrow}{\reflectbox{$\Leftarrow$}}
%\renewcommand{\Longrightarrow}{\reflectbox{$\Longleftarrow$}}

\newcommand{\tuml}{{\sc TikZ-uml}}
\newcommand{\TikZ}{{\sc TikZ}}

\lstset{language=[LaTeX]tex, basicstyle=\small, breaklines=true}

%\date{} % date %
\title{Le package \tuml} % titre %
\author{Nicolas {\sc Kielbasiewicz}} % auteur %

\begin{document}

\maketitle

Devant les immenses possibilités offertes par la librairies PGF/TikZ, et devant l'absence apparente de package dédié aux diagrammes UML, j'ai été amené à développer le package \tuml, proposant un ensemble de commandes et d'environnements spécifiques à ce type de diagrammes. Il s'inscrit dans la logique du package pst-uml développé pour des raisons similaires en PSTricks. Dans son état actuel, la librairie ne permet de définir que des diagrammes de classes complets de manière assez simple, mais il est prévu de proposer des diagrammes de cas d'utilisation, des diagrammes de séquence, voire ensuite d'autres diagrammes.

Voici un exemple de diagramme de classes que l'on peut réaliser :

\begin{center}
\inputTikZ{figure1}
\end{center}

Nous allons maintenant vous présenter les différentes fonctionnalités offertes par \tuml.

\tableofcontents

\chapter{Diagrammes de classes}\label{c.class}

\section{Package, classe, attributs et opérations}\label{s.packageclass}

\subsection{Définir un package}\label{ss.package}

Un package est défini par l'environnement {\tt umlpackage} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure2.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure2}
\end{center}
\end{minipage}

\medskip

Les options {\tt x} et {\tt y} permettent de définir la position du package dans la figure. Elles valent toutes deux 0 par défaut. 

\begin{itemize}
\item Quand un package contient des classes ou des sous-packages, sa taille s'ajuste automatiquement à son contenu.
\item On peut définir autant de packages que l'on veut dans une figure.
\item Il existe un raccourci pour définir un package qui sera vide (on ne définira pas de classes à l'intérieur) : la commande {\tt umlemptypackage} qui prend les mêmes arguments que l'environnement {\tt umlpackage}
\end{itemize}

\subsection{Définir une classe}\label{ss.class}

Pour définir une classe, on utilise l'environnement {\tt umlclass}, de la même manière que l'environnement {\tt umlpackage} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure3.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure3}
\end{center}
\end{minipage}

Les options {\tt x} et {\tt y} définissent la position de la classe. 2 possibilités : si la classe est définie dans un package, il s'agit de la position relative de la classe dans le package; dans le cas contraire, il s'agit de la position dans la figure. Elles valent toutes deux 0 par défaut. Comme pour le package, il existe un raccourci pour définir une classe vide (dont on ne définira pas les attributs et les opérations) : la commande {\tt umlemptyclass}, qui prend les mêmes arguments que l'environnement {\tt umlclass}.

\subsubsection{Définir la largeur d'une classe}

Par défaut, la largeur d'une classe est de 10ex. On peut la modifier avec l'option {\tt width} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure4.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure4}
\end{center}
\end{minipage}

\subsubsection{Spécifier le type d'une classe}

La classe peut être de différents types : classe, interface, typedef, enum. On utilise l'option {\tt type} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure5.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure5}
\end{center}
\end{minipage}

\subsubsection{Spécifier des paramètres templates}

La classe peut être un template. On spécifie la liste des paramètres avec l'option {\tt template} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure6.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure6}
\end{center}
\end{minipage}

\subsection{Définir des attributs et des opérations}\label{ss.attrop}

On définit les attributs à l'intérieur d'un environnement {\tt umlclass} à l'aide de la commande {\tt umlattr}. On lui passe en argument la liste des arguments en les séparants par $\backslash\backslash$. On procède de même pour les opérations avec la commande {\tt umlop} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure7.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure7}
\end{center}
\end{minipage}

\medskip

Pour définir un attribut ou une méthode statique, on peut utiliser la commande {\tt umlstatic}. De même, la commande {\tt umlvirt} permet de spécifier des fonctions virtuelles.

\section{Relations entre classes}\label{s.rel}

\subsection{Commande générale}\label{ss.relgen}

Chaque classe et chaque package sont représentés par un n\oe{}ud ayant le même nom. Pour définir une relation entre 2 classes, on va donc spécifier le nom de la classe de départ, le nom de la classe d'arrivée et un certain nombre d'options propres à la relation.

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure8.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure8}
\end{center}
\end{minipage}

D'un point de vue sémantique, il existe 11 relations différentes, toutes présentes dans \tuml{} :

\begin{description}
\item[La dépendance :] utiliser la commande {\tt umldep}
\item[L'association :] utiliser la commande {\tt umlassoc}
\item[L'association unidirectionnelle :] utiliser la commande {\tt umluniassoc}
\item[L'aggrégation :] utiliser la commande {\tt umlaggreg}
\item[L'aggrégation unidirectionnelle :] utiliser la commande {\tt umluniaggreg}
\item[La composition :] utiliser la commande {\tt umlcompo}
\item[La composition unidirectionnelle :] utiliser la commande {\tt umlunicompo}
\item[L'import :] utiliser la commande {\tt umlimport}
\item[L'héritage :] utiliser la commande {\tt umlinherit}
\item[L'implémentation :] utiliser la commande {\tt umlimpl}
\item[La réalisation :] utiliser la commande {\tt umlreal}
\end{description}

Ces 11 commandes sont basées sur le même schéma (la commande {\tt umlrelation}) et prennent en théorie exactement le même jeu d'options. En pratique, certaines options concernent certains types de relations.

\subsection{Définir la géométrie de la relation}\label{ss.relgeom}

Comme vous avez pu le voir dans les exemples précédents, on peut spécifier la forme géométrique de la relation à l'aide de l'option \hypertarget{geometry}{{\tt geometry}}. Cette option demande un argument parmi la liste -~- (ligne droite), -| (horizontal puis vertical), |- (vertical puis horizontal), -|- (chicane horizontale) ou |-| (chicane verticale), ces arguments étant largement inspirés de la philosophie TikZ.

Il apparaît à l'utilisation que cette option est très souvent utilisée. C'est la raison pour laquelle un alias de la commande {\tt umlrelation} a été défini pour chacune des valeurs possibles de l'option {\tt geometry} :

\begin{description}
\item[umlHVrelation :] alias de umlrelation avec geometry=-|
\item[umlVHrelation :] alias de umlrelation avec geometry=|-
\item[umlHVHrelation :] alias de umlrelation avec geometry=-|-
\item[umlVHVrelation :] alias de umlrelation avec geometry=|-|
\end{description}

\remarque{Pour chacun de ces 4 alias, l'option {\tt geometry} est interdite.}

\remarque{Il n'y a pas d'alias dans le cas de la valeur -~- pour la seule raison qu'il s'agit de la valeur par défaut.}


\subsection{Ajuster la géométrie de la relation}\label{ss.relfitgeom}

Lorsque la géométrie de la relation contient 2 segments, on peut spécifier les coordonnées du point intermédiaire, ou n\oe{}ud de contrôle. Plutôt que la commande {\tt umlrelation}, on utilisera {\tt umlCNrelation}, elle aussi déclinée en 11 alias :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure9.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure9}
\end{center}
\end{minipage}

\medskip

Lorsque la géométrie de la relation contient 3 segments, la position relative du segment central entre les classes est défini comme passant par le milieu entre les classes reliées. On peut ajuster ce paramètre à l'aide de l'option \hypertarget{weight}{{\tt weight}} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure10.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure10}
\end{center}
\end{minipage}

Dans certains cas, cette option est peu pratique, car elle demande de calculer la valeur à passer à l'option. On peut alors procéder autrement en utilisant les options \hypertarget{arm1}{{\tt arm1}} et \hypertarget{arm2}{{\tt arm2}} qui fixent la taille respectivement du premier et dernier segment. Regardons ici les deux exemples utilisant respectivement l'option {\tt weight} et l'option {\tt arm1} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure11.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure11}
\end{center}
\end{minipage}

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure12.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure12}
\end{center}
\end{minipage}

\medskip

Les options {\tt arm1} et {\tt arm2} prennent aussi des valeurs négatives. Que se passe t'il alors ?
Si l'on passe une valeur positive, alors le bras sera orienté dans le sens normal (soit à droite, soit vers le haut). Si l'on passe une valeur négative, alors l'arc sera orienté dans l'autre sens, ce qui permet de dessiner d'autres types de relations à 3 segments, comme le montre l'exemple ci-dessous :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure13.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure13}
\end{center}
\end{minipage}


\subsection{Définir des informations sur les attributs associés à une relation}\label{ss.relattr}

Une relation visualise la dépendance entre deux classes et se traduit généralement sous la forme d'un attribut. On peut spécifier son nom avec l'option {\tt arg1} ou {\tt arg2}, et sa multiplicité avec {\tt mult1} ou {\tt mult2} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure14.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure14}
\end{center}
\end{minipage}

\medskip

Pour les relations unidirectionnelles, on ne va être amené à utiliser que les options {\tt arg2} et {\tt mult2}. Comme il paraît dans ce cas peu naturel que ces options finissent par 2, on peut utiliser les options {\tt arg} et {\tt mult} qui jouent le même rôle.

Par ailleurs, lorsqu'on définit à la fois le nom et la multiplicité d'un attribut, on peut le faire sous une forme plus contractée à l'aide des options {\tt attr1}, {\tt attr2} et {\tt attr} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure15.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure15}
\end{center}
\end{minipage}

\medskip

L'avantage de cette forme contractée est de pouvoir s'affranchir de la sémantique entre le nom et la multiplicité et de pouvoir alors inverser les deux :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure16.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure16}
\end{center}
\end{minipage}

\medskip

\subsection{Positionner les informations sur les attributs associés à une relation}\label{ss.relposattr}

On peut positionner les informations définies dans la section précédente à l'aide des options {\tt pos1}, {\tt pos2} et {\tt pos}.
La commande {\tt umlrelation} détermine elle-même si le nom et la multiplicité doivent être respectivement à gauche et à droite, ou au-dessus et au-dessous, de la flèche, selon sa géométrie et leur position. Pour les initiés à TikZ, elle se base sur les options {\tt auto} et {\tt swap}.

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure17.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure17}
\end{center}
\end{minipage}

\medskip

Il est à noter que l'intervalle de valeurs de la position d'un nom d'argument dépend du nombre de segments constituants la flèche de relation. Si la flèche est droite, alors la position doit être comprise entre 0 (classe de départ) et 1 (classe d'arrivée). Si la flèche comporte un seul angle droit, alors la position varie entre 0 et 2 (point d'arrivée), la valeur 1 correspondant à l'angle. Dans les deux autres possibilités, la position varie entre 0 et 3 (point d'arrivée), les valeurs 1 et 2 correspondant respectivement au premier et au deuxième angle.

\subsection{Ajuster l'alignement des informations sur les attributs associés à une relation}\label{ss.relalign}

Par défault, nom et multiplicité de l'argument, quand ils sont affichés l'un au dessus de l'autre, sont centrés. Les options {\tt align1}, {\tt align2} et {\tt align} permettent de les justifier à gauche ou à droite.

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure18.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure18}
\end{center}
\end{minipage}

\subsection{Définir et positionner le stéréotype d'une relation}\label{ss.relstereo}

Le stéréotype d'une relation est un mot clé contenu entre $<<$ et $>>$. On peut le définir à l'aide de l'option {\tt stereo} et le positionner à l'aide de l'option \hypertarget{posstereo}{{\tt pos stereo}}.

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure19.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure19}
\end{center}
\end{minipage}

\subsection{Modifier les points d'ancrage d'une relation}\label{ss.relanchor}

Le paragraphe qui vient concerne les relations dont la géométrie est à base de flèches segmentées. Par défaut, elles partent du centre du n\oe{}ud de la classe d'origine et vont au centre du n\oe{}ud de la classe cible. Il est possible d'ajuster ce comportement avec la paire d'options \hypertarget{anchor1}{{\tt anchor1}}, \hypertarget{anchor2}{{\tt anchor2}}.

\medskip

\begin{minipage}{0.6\textwidth}
\lstinputlisting{fig/figure20.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure20}
\end{center}
\end{minipage}

\medskip

Les arguments que l'on donne sont des angles dont la valeur est en degré et peut être négative. Le mécanisme interne de la librairie {\sc TikZ} effectue un modulo pour ramener ce nombre dans l'intervalle adéquat. La valeur 0 indique l'est, 90, indique le nord, 180 indique l'ouest, et 270 (ou -90) indique le sud du n\oe{}ud. La figure ci-dessous illustre cette option et sa signification angulaire, sur 2 exemples de n\oe{}ud de type rectangle, comme c'est le cas pour les classes. \`{A} noter que les points d'ancrage frontières (pour prendre la terminologie TikZ) dépendent bien des dimensions du n\oe{}ud.

\begin{center}
\inputTikZ{figure21}
\end{center}

Il arrive finalement très souvent que l'on définisse les deux options {\tt anchor1} et {\tt anchor2} simultanément. On peut donc utiliser une forme contractée : l'option \hypertarget{anchors}{{\tt anchors}} qui s'utilise de la manière suivante, en reprenant l'exemple précédent :

\medskip

\begin{minipage}{0.6\textwidth}
\lstinputlisting{fig/figure22.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure22}
\end{center}
\end{minipage}

\subsection{Relation récursive}\label{ss.relrec}

Il est possible de définir une relation récursive, c'est-à-dire une relation d'une classe à elle-même. Dans ce cas, l'option {\tt geometry} doit être ignorée, mais 3 options deviennent très utiles : {\tt angle1} détermine l'angle de départ, {\tt angle2} détermine l'angle d'arrivée, et {\tt loopsize} donne une idée de la taille de la boucle.

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure23.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure23}
\end{center}
\end{minipage}

\medskip

\`{A} l'utilisation, il s'avère que l'on utilise très souvent les 3 options en même temps. C'est la raison pour laquelle il existe une forme contractée, l'option {\tt recursive} qui s'utilise de la manière suivante :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure24.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure24}
\end{center}
\end{minipage}

\subsection{Nom des points de construction d'une relation}\label{ss.relptname}

Pour voir l'importance de la possibilité de donner un nom à une relation et son utilité, il nous faut d'abord ici répondre à la question technique suivante : comment les flèches sont-elles concrètement définies ?

Pour construire une flèche, on a besoin de définir des n\oe{}uds de contrôle, auquel il faut donner un nom. Le seul moyen d'identifier de manière unique une relation est de lui donner un identifiant à travers un compteur que l'on va incrémenter. Supposons que notre relation a pour identifiant $i$. Le nom de la relation que l'on appellera dans ce qui suit {\it relname} est alors initialisé à : relation-$i$

Le premier n\oe{}ud défini est le milieu de la relation, il s'appelle {\it relname-middle}. Je ne parlerai pas ici du placement adéquat de l'argument et de sa multiplicité dans un souci de simplification. Il y a donc 3 possibilités :

\begin{enumerate}
\item Si la flèche est une ligne continue (droite ou récursive), il est renommé en {\it relname-1}.

\begin{center}
\inputTikZ{figure25}
\end{center}
\item Si la flèche a un seul angle droit, alors l'unique n\oe{}ud correspondant à l'angle droit est nommé {\it relname-2}, ce qui suffit à tracer la flèche. On définit par ailleurs les milieux des 2 arêtes constituant la flèche, nommés respectivement {\it relname-1} et {\it relname-3}.

\begin{center}
\inputTikZ{figure26}
\end{center}
\item Si la flèche à deux angles droits, ceux-ci sont définis de manière unique à l'aide de {\it relname-middle}, ce qui suffit à tracer la flèche. On nomme les n\oe{}uds aux angles droits respectivement {\it relname-2} et {\it relname-4}. On définit alors les milieux des 3 arêtes constituant la flèche, nommés respectivement {\it relname-1}, {\it relname-3}, et {\it relname-5}.

\begin{center}
\inputTikZ{figure27}
\end{center}
\end{enumerate}

Il faut toutefois reconnaître que la définition par défaut de {\it relname} est non seulement peu pratique puisqu'on n'a pas vraiment accès à la numérotation, mais aussi fortement sujette à l'ordre dans lequel on définit les relations, donc peu portable en cas de modification de diagrammes. Pour simplifier cela, on va pouvoir définir {\it relname} à l'aide de l'option {\tt name}. Et la raison pour laquelle cette option existe va être expliquée dans les 2 sections suivantes.

\subsection{Tracer un point à une intersection de relations}\label{ss.relpt}

Il arrive que dans un diagramme des relations se croisent et se chevauchent. Prenons 2 flèches qui se croisent. Est-ce que les 2 points de départ peuvent aller aux deux points d'arrivée ? Si oui, alors on va vouloir tracer un point à l'intersection des deux flèches, qui vraisemblablement va être un des n\oe{}uds de contrôle définis sur la relation. On utilisera pour cela la commande {\tt umlpoint}.

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure28.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure28}
\end{center}
\end{minipage}

\section{Note de commentaires / contraintes}\label{s.note}

Une note est un commentaire de texte attaché à une classe ou une relation. La commande {\tt umlnote} demande pour cela le nom du n\oe{}ud auquel il faut se rattacher et le texte du commentaire en argument :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure29.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure29}
\end{center}
\end{minipage}

\medskip

Là encore, on va pouvoir donner le nom d'un des points de contrôle d'une relation si l'on veut y attacher une note. Il faut donc pour cela pouvoir définir soi-même un nom simple à ces points :

\medskip

\begin{minipage}{0.6\textwidth}
\lstinputlisting{fig/figure30.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure30}
\end{center}
\end{minipage}

\medskip

\medskip

Les notes sont utilisées pour 2 choses : les commentaires et la données de contraintes (généralement au format OCL).

\medskip

La commande {\tt umlnote} dispose des options suivantes :

\begin{description}
\item[x, y] Ces 2 options définissent les coordonnées de la note
\item[width] Cette option définit la largeur de la note. Pour les habitués de TikZ, elle encapsule l'option {\bf text width}
\item[weight, arm, anchor1, anchor2, anchors] Ces options ont exactement le même rôle que pour la commande {\tt umlrelation}, {\bf arm} étant équivalent à {\bf arm1}, c'est-à-dire attachée à la note source et pas à la cible. 
\end{description}

\medskip

\begin{minipage}{0.6\textwidth}
\lstinputlisting{fig/figure31.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure31}
\end{center}
\end{minipage}

\medskip

\medskip

Puisque l'option {\tt geometry} est présente, de la même manière que pour {\tt umlrelation}, ont été définis les alias {\tt umlHVnote}, {\tt umlVHnote}, {\tt umlHVHnote} et {\tt umlVHVnote}.

\remarque{Pour chacun de ces 4 alias, l'option {\tt geometry} est interdite.}

\remarque{Il n'y a pas d'alias dans le cas de la valeur -~- pour la seule raison qu'il s'agit de la valeur par défaut.}

\section{Personnaliser l'apparence}\label{s.classset}

Grâce à la commande {\tt tikzumlset}, il est possible de modifier l'apparence par défaut des packages, des classes et des notes. Les options que l'on peut personnaliser sont :

\begin{description}
\item[text : ] permet de spécifier la couleur du texte (=black par défaut),
\item[draw :] permet de spécifier la couleur des traits (=black par défaut),
\item[fill class :] permet de spécifier la couleur de fond des classes (=yellow!20 par défaut),
\item[fill template :] permet de spécifier la couleur de fond des boites templates (=yellow!2 par défaut),
\item[fill package :] permet de spécifier la couleur de fond des packages (=blue!20 par défaut),
\item[fill subpackage :] permet de spécifier la couleur de fond des sous-packages (=blue!20 par défaut),
\item[fill note :] permet de spécifier la couleur de fond des notes (=green!20 par défaut),
\item[font :] permet de définir le style de fonte du texte contenu dans tous les éléments d'un diagramme (=$\backslash$small par défaut).
\end{description}

Par ailleurs, les commandes de relation disposent toutes d'une option {\tt style} prenant en argument un nom de style au sens de TikZ.

Regardons l'exemple de la définition de la commande {\tt umlinherit} :

\begin{lstlisting}
\tikzstyle{tikzuml inherit style}=[color=\tikzumldrawcolor, -open triangle 45]
\newcommand{\umlinherit}[3][]{\umlrelation[style={tikzuml inherit style}, #1]{#2}{#3}}
\end{lstlisting}

Vous pouvez donc très facilement définir une commande sur le même modèle en définissant un style particulier.

\section{Exemples}

\subsection{Exemple de l'introduction, pas à pas}

On va construire petit à petit l'exemple illustrant la première page de ce document afin de mettre en valeur les différentes commandes utilisées.

\subsubsection{Définition des packages p, sp1 et sp2}

On laisse le package p aux coordonnées (0,0) (comportement par défaut), et on place le sous-package p1 aux coordonnées (0,0) et le sous-package p2 aux coordonnées (10,-6).

{\color{red!70!black}
\lstinputlisting[firstline=1, lastline=2]{introex.tikz}\vspace{-0.4cm}
\lstinputlisting[firstline=10, lastline=11]{introex.tikz}\vspace{-0.4cm}
\lstinputlisting[firstline=15, lastline=15]{introex.tikz}\vspace{-0.4cm}
\lstinputlisting[firstline=19, lastline=19]{introex.tikz}
}

\begin{center}
\inputTikZ{figure32}
\end{center}

\subsubsection{Définition des classes A, B, C, D et de leurs attributs et opérations}

La classe A est en (0,0) dans le sous-package sp1 et a un paramètre template : T. La classe B est positionnée 3 unités en dessous de A, toujours dans le sous-package sp1, et  possède un attribut statique et une opération virtuelle. La classe C est une interface en (0,0) dans le sous-package sp2. La classe D est placée en (2,-11) dans le package p.

La classe A a deux attributs. La classe B a un attribut et deux opérations dont une virtuelle. La classe C a deux attributs. La classe D a un attribut.

\lstinputlisting[firstline=1, lastline=2]{introex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=3, lastline=9]{introex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=10, lastline=11]{introex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=12, lastline=14]{introex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=15, lastline=15]{introex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=16, lastline=18]{introex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=19, lastline=19]{introex.tikz}

\begin{center}
\inputTikZ{figure33}
\end{center}


\subsubsection{Définition des relations}

On définit une association entre les classes C et B, une composition unidrectionnelle entre les classes D et C, une relation d'import nommée "import" entre les sous-packages sp2 et sp1 (avec modification des ancres), une relation d'aggrégation récursive sur la classe D et une relation d'héritage entre les classes D et B. Sur ces relations, on va spécifier des noms d'arguments et leurs multiplicités. Regardez la valeur donnée à la position de ces éléments suivant la géométrie de la flèche.

\medskip

\hspace{-0.7cm}\lstinline{...}
{\color{red!70!black}
\lstinputlisting[firstline=20, lastline=24]{introex.tikz}
}

\begin{center}
\inputTikZ{figure34}
\end{center}

\subsubsection{Définition des notes}

On rajoute enfin une note attchée à la classe B et une note attachée à la relation d'import affectée du nom import.

\medskip

\hspace{-0.7cm}\lstinline{...}
{\color{red!70!black}
\lstinputlisting[firstline=25]{introex.tikz}
}

\begin{center}
\inputTikZ{figure35}
\end{center}

\subsubsection{Modification du style}

On illustre l'utilisation de la commande {\tt tikzumlset} en changeant les couleurs associées à la classe et le type de font. On peut par ailleurs modifier les couleurs d'une classe donnée avec les options {\tt draw}, {\tt text} et {\tt fill}

\medskip

\begin{lstlisting}
\tikzumlset{fill class=red!20, fill template=violet!10, font=\bfseries\footnotesize}
\begin{tikzpicture}
...
\umlclass[x=2,y=-11, fill=orange!50, draw=white, text=red]{D}{
  n : uint
  }{}
...
\end{tikzpicture}
\end{lstlisting}

\begin{center}
\inputTikZ{figure36}
\end{center}

\subsection{Définir une spécialisation de classe}

Une spécialisation de classe est de l'héritage d'un patron de classe dans lequel l'un des paramètres à son type fixé. Pour définir cette relation, c'est la commande {\tt umlreal} qui va servir ici, ainsi que l'option {\tt stereo} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure37.tikz}
\end{minipage}
\begin{minipage}{0.5\textwidth}
\begin{center}
\inputTikZ{figure37}
\end{center}
\end{minipage}

\section{Règles de priorité des options et bugs identifiés}\label{s.classbug}

\begin{enumerate}
\item L'option {\tt geometry} prime toujours sur les autres arguments. Cela signifie en particulier que si elle n'a pas sa valeur par défaut (--~--), alors les options {\tt angle1}, {\tt angle2} et {\tt loopsize}, paramétrant les relations récursives, seront ignorées.
\item Dans le cas d'un patron de classe, il existe des cas où une relation la concernant sera mal définie, comme le montre le dessin ci-dessous, où le losange de la relation d'aggrégation est caché par le paramètre template :

\begin{minipage}{0.6\textwidth}
\lstinputlisting{fig/figure38.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure38}
\end{center}
\end{minipage}

\medskip

On peut toutefois corriger partiellement ce problème en reliant la flèche directement entre la partie template de la classe A et la classe B en rajoutant le suffixe -template et en ajustant l'ancre de départ (la valeur -30 est assez satisfaisante) : 

\medskip

\begin{minipage}{0.6\textwidth}
\lstinputlisting{fig/figure39.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure39}
\end{center}
\end{minipage}

\medskip

\item Le comportement de placement automatique des informations d'un attribut sur une relation peut surprendre quand on veut le court-circuiter. Reprenons l'exemple de l'introduction. Si l'on regarde la rela	tion d'association et les attributs {\it toto} et {\it tata}. Si {\it toto} est au-dessus, {\it tata} est lui en dessous. Demandons maintenant de justifier à droite l'attribut {\it tata} (Au passage, on met sa position à 0.1). On constate alors que les positions de {\it tata} et de sa multiplicité s'inversent.

\begin{center}
\inputTikZ{figure40}
\end{center}

\end{enumerate}

\chapter{Diagrammes de cas d'utilisation}\label{c.usecase}

Voici un exemple de diagramme de cas d'utilisation que l'on peut réaliser :

\begin{center}
\inputTikZ{usecaseex}
\end{center}

Nous allons voir successivement comment définir les 4 éléments constitutifs d'un tel diagramme : le système, les acteurs, les cas d'utilisation et les relations.

\section{Système}\label{s.system}

Un système est défini à l'aide de l'environnement {\tt umlsystem} :

\medskip

\begin{minipage}{0.6\textwidth}
\lstinputlisting{fig/figure41.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure41}
\end{center}
\end{minipage}

\medskip

Les options {\tt x} et {\tt y} permettent de positionner le système dans la figure. Elles valent toutes deux 0 par défaut. A l'intérieur de cet environnement, on définira les cas d'utilisation, tandis qu'à l'extérieur, on définira les acteurs.

\section{Acteur}\label{s.actor}

Un acteur est défini par la commande {\tt umlactor} :

\medskip

\begin{minipage}{0.6\textwidth}
\lstinputlisting{fig/figure42.tikz}
\end{minipage}
\begin{minipage}{0.4\textwidth}
\begin{center}
\inputTikZ{figure42}
\end{center}
\end{minipage}

\medskip

Les options {\tt x} et {\tt y} permettent de positionner l'acteur dans la figure. Elles valent toutes deux 0 par défaut. On peut également redimensionner le symbole de l'acteur avec l'option {\tt scale}. Cela adapte également la position du texte en dessous :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure43.tikz}
\end{minipage}
\begin{minipage}{0.5\textwidth}
\begin{center}
\inputTikZ{figure43}
\end{center}
\end{minipage}

\medskip

Le symbole de l'acteur est défini en unités relatives de la taille de fonte (unité en ex). Ce n'est par contre pas le cas de la distance séparant le symbole du texte en dessous. On peut alors corriger cela en fixant cette distance avec l'option {\tt below} (0.5cm par défaut).

\medskip
 
\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure44.tikz}
\end{minipage}
\begin{minipage}{0.5\textwidth}
\begin{center}
\inputTikZ{figure44}
\end{center}
\end{minipage}

\section{Cas d'utilisation}\label{s.usecase}

Un cas d'utilisation est défini avec la commande {\tt umlusecase} :

\medskip

\begin{minipage}{0.5\textwidth}
\lstinputlisting{fig/figure45.tikz}
\end{minipage}
\begin{minipage}{0.5\textwidth}
\begin{center}
\inputTikZ{figure45}
\end{center}
\end{minipage}

\medskip

Les options {\tt x} et {\tt y} permettent de positionner le cas d'utilisation dans la figure ou dans le système le contenant. Elles valent toutes deux 0 par défaut. Le texte passé en argument obligatore est l'intitulé du cas d'utilisation. Le n\oe{}ud le représentant possède un nom par défaut, basé sur un compteur global, de la forme usecase-17. Pour des raisons pratiques, on peut renommer un cas d'utilisation à l'aide de l'option {\tt name}.

Par ailleurs, on peut fixer la taille du n\oe{}ud avec l'option {\tt width}.

\medskip

Maintenant que nous avons vu tous les éléments constitutifs d'un diagramme de cas d'utilisation, nous allons pouvoir aborder les relations entre ces éléments.

\section{Relations}\label{s.userel}

Les relations dans un diagramme de cas d'utilisation sont de 4 natures :

\begin{itemize}
\item Des relations d'héritage, entre acteurs, ou entre cas d'utilisation. On utilisera pour cela la commande {\tt umlinherit} et ses dérivées, abordées en \autoref{ss.relgen}.
\item Des relations d'association, entre un acteur et un cas d'utilisation. On utilisera pour cela la commande {\tt umlassoc} et ses dérivées, abordées en \autoref{ss.relgen}.
\item Des relations d'inclusion ou d'extension. Graphiquement, ce sont des flèches de dépendance, au sens des diagrammes de classes, avec le stéréotype {\tt extend} ou {\tt include}. Des alias de la commande {\tt umlrelation}, nommés {\tt umlinclude}, {\tt umlHVinclude}, \ldots, {\tt umlextend}, {\tt umlHVextend}, \ldots, sont disponibles pour définir de telles flèches.
\end{itemize}

Les options \hyperlink{anchor1}{{\tt anchor1}}, \hyperlink{anchor2}{{\tt anchor2}}, \hyperlink{anchors}{{\tt anchors}}, \hyperlink{arm1}{{\tt arm1}}, \hyperlink{arm2}{{\tt arm2}}, \hyperlink{weight}{{\tt weight}}, \hyperlink{geometry}{{\tt geometry}} (uniquement pour {\tt umlinclude} et {\tt umlextend}), et \hyperlink{posstereo}{{\tt pos stereo}} sont toujours utilisables.

\medskip

\begin{minipage}{0.51\textwidth}
\lstinputlisting{fig/figure46.tikz}
\end{minipage}
\begin{minipage}{0.49\textwidth}
\begin{center}
\inputTikZ{figure46}
\end{center}
\end{minipage}

\medskip

\section{Personnalisation}\label{s.fitusecase}

Grace à la commande {\tt tikzumlset}, on peut modifier globalement les couleurs par défaut des cas d'utilisation, systèmes, acteurs et relations :

\begin{description}
\item[text :] permet de spécifier la couleur du texte (=black par défaut),
\item[draw :] permet de spécifier la couleur des traits (=black par défaut),
\item[fill usecase :] permet de spécifier la couleur de fond des cas d'utilisation (=blue!20 par défaut),
\item[fill system :] permet de spécifier la couleur de fond des systèmes (=white par défaut),
\item[font :] permet de spécifier le style de fonte du texte (=$\backslash$small par défaut).
\end{description}

On peut également utiliser les options {\tt text}, {\tt draw} et {\tt fill} sur un élément particulier pour lui modifier ses couleurs, comme illustré dans l'exemple d'introduction.

\section{Exemples}

\subsection{Exemple de l'introduction, pas à pas}

\subsubsection{Définition des acteurs}

{\color{red!70!black}
\lstinputlisting[firstline=11, lastline=13]{fig/usecaseex.tikz}
}

\begin{center}
\inputTikZ{figure47}
\end{center}

\subsubsection{Définition des cas d'utilisation}

En plus de définir les cas d'utilisation, on illustre l'utilisation locale de l'option {\tt fill}.

{\color{red!70!black}
\lstinputlisting[firstline=3, lastline=8]{fig/usecaseex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=11, lastline=13]{fig/usecaseex.tikz}

\begin{center}
\inputTikZ{figure48}
\end{center}

\subsubsection{Définition du système}

Le système étant défini comme une boîte dont servant de nouveau repère de coordonnées, on va devoir modifier les coordonnées des cas d'utilisation relativement à celles du système.

{\color{red!70!black}
\lstinputlisting[firstline=2, lastline=2]{fig/usecaseex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=3, lastline=8]{fig/usecaseex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=9, lastline=9]{fig/usecaseex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=10, lastline=13]{fig/usecaseex.tikz}

\begin{center}
\inputTikZ{figure49}
\end{center}

\subsubsection{Définition des relations et de la note}

On remarquera l'utilisation de l'option {\tt name} pour s'assurer simplement de la bonne définition de la note, et son intérêt également pour les cas d'utilisation, afin de ne pas avoir à se rappeler de l'ordre dans lequel ils sont définis, comme c'est le cas dans cet exemple simple :

\lstinputlisting[firstline=2, lastline=13]{fig/usecaseex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=14, lastline=25]{fig/usecaseex.tikz}
}

\begin{center}
\inputTikZ{figure50}
\end{center}

%\section{Règles de priorité des options et bugs identifiés}\label{s.usecasebug}

\chapter{Diagrammes d'états-transitions}\label{c.statetrans}

Voici un exemple de diagramme d'états-transitions que l'on peut réaliser :

\begin{center}
\inputTikZ{statediagex}
\end{center}

Nous allons voir successivement comment définir les éléments constitutifs d'un tel diagramme : les 10 types d'états et les transitions.

\newpage

\section{Les états}\label{s.state}

\subsection{Etat}\label{ss.state}

Un état \og standard\fg{} se définit à l'aide de l'environnement {\tt umlstate} :

\medskip

\begin{minipage}{0.51\textwidth}
\lstinputlisting{fig/figure51.tikz}
\end{minipage}
\begin{minipage}{0.49\textwidth}
\begin{center}
\inputTikZ{figure51}
\end{center}
\end{minipage}

\medskip

Les options {\tt x} et {\tt y} permettent de positionner l'état dans la figure, ou dans un autre état. Elles valent toutes deux 0 par défaut. L'argument est le label de l'état. Le n\oe{}ud représentatnt l'état a par défaut un nom basé sur un compteur. Pour des raisons pratiques, lors de la définition de transitions par exemple, on peut le renommer à l'aide de l'option{\tt name}.

\medskip

On peut également définir la largeur minimale d'un état avec l'option {\tt width} (10ex par défaut).

\medskip

On peut définir un état dans un autre état. Dans ce cas, les coordonnées des sous-états sont relatives à l'état parent :

\medskip

\begin{minipage}{0.51\textwidth}
\lstinputlisting{fig/figure52.tikz}
\end{minipage}
\begin{minipage}{0.49\textwidth}
\begin{center}
\inputTikZ{figure52}
\end{center}
\end{minipage}

\medskip

Si l'on veut définir un état sans le décomposer, on peut utiliser la commande {\tt umlbasicstate} qui est un raccourci vers l'environnement {\tt umlstate}.

\medskip

Regardonc maintenant les états spécifiques :

\medskip

\begin{minipage}{0.51\textwidth}
\lstinputlisting{fig/figure53.tikz}
\end{minipage}
\begin{minipage}{0.49\textwidth}
\begin{center}
\inputTikZ{figure53}
\end{center}
\end{minipage}

\medskip

De gauche à droite et de haut en bas :

\medskip

\begin{itemize}
\item Un état initial se définit à l'aide de la commande {\tt umlstateinitial}.
\item Un état final se définit à l'aide de la commande {\tt umlstatefinal}.
\item Un état de jonction se définit à l'aide de la commande {\tt umlstatejoin}.
\item Un état de décision se définit à l'aide de la commande {\tt umlstatedecision}.
\item Un état d'entrée se définit à l'aide de la commande {\tt umlstateenter}.
\item Un état de sortie se définit à l'aide de la commande {\tt umlstateexit}.
\item Un état de fin se définit à l'aide de la commande {\tt umlstateend}.
\item Un état d'historique se définit à l'aide de la commande {\tt umlstatehistory}.
\item Un état d'historique profond se définit à l'aide de la commande {\tt umlstatedeephistory}.
\end{itemize}

\medskip

Ces commandes prennent toutes pour options {\tt name}, pour renommer le n\oe{}ud, et {\tt width} pour fixer sa taille, et on peut les utiliser à l'intérieur d'un environnement {\tt umlstate} :

\medskip

\begin{minipage}{0.51\textwidth}
\lstinputlisting{fig/figure54.tikz}
\end{minipage}
\begin{minipage}{0.49\textwidth}
\begin{center}
\inputTikZ{figure54}
\end{center}
\end{minipage}

\medskip

\section{Les transitions}\label{s.trans}

Les transitions sont les noms des relations dans un diagramme d'états-transitions. On les définit à l'aide de la commande {\tt umltrans} qui dérive de {\tt umlrelation}. On va distinguer le cas des transitions unidirectionnelles et celui des transitions recursives.

\subsection{Les transitions unidirectionnelles}\label{s.unitrans}

De par l'existence de l'option {\tt geometry}, on va définir de même les alias {\tt umlHVtrans}, {\tt umlVHtrans}, {\tt umlVHVtrans} et {\tt umlHVHtrans}. Graphiquement, ce sont l'utilisation de ces alias qui sont les plus intéressants, dans la mesure où tous les coins d'une flèche de transition sont arrondis.

\medskip

\begin{minipage}{0.51\textwidth}
\lstinputlisting{fig/figure55.tikz}
\end{minipage}
\begin{minipage}{0.49\textwidth}
\begin{center}
\inputTikZ{figure55}
\end{center}
\end{minipage}

\medskip

Toutes les options de {\tt umlrelation} peuvent être utilisées avec {\tt umltrans} et ses dérivées.

\subsection{Les transitions récursives}\label{s.rectrans}

Les transitions récursives sont graphiquement les plus délicates à mettre en \oe{}uvre, car elles ont l'aspect de rectangles aux coins arrondis, contrairement aux flèches récursives des diagrammes de classes. Elles se comportent donc, sur le principe, comme les flèches dont l'option {\tt geometry} est -|- ou |-|, c'est-à-dire des flèches composées de plusieurs segments.

\medskip

\begin{minipage}{0.51\textwidth}
\lstinputlisting{fig/figure56.tikz}
\end{minipage}
\begin{minipage}{0.49\textwidth}
\begin{center}
\inputTikZ{figure56}
\end{center}
\end{minipage}

\medskip

L'option {\tt recursive direction} est fondamentale. En effet, la donnée des angles de départ et d'arrivée ne suffit pas à savoir la direction de départ et d'arrivée de la flèche récursive. On est donc obligé de le préciser. 2 cas se présentent :

\medskip

\begin{itemize}
\item Soit la flèche est constituée de 3 segments. Dans ce cas, les n\oe{}uds utilisables sont répartis comme suit :

\begin{center}
\inputTikZ{figure57}
\end{center}

\item Soit la flèche est constituée de 4 segments. Dans ce cas, les n\oe{}uds utilisables sont répartis comme suit :

\medskip

\begin{center}
\inputTikZ{figure58}
\end{center}

\vspace{-4cm}

\end{itemize}

\subsection{Transitions entre sous-états}\label{ss.substatetrans}

Lorsqu'on définit des transitions entre sous-états, la transition doit être intégralement représentée à l'intérieur de l'état parent. C'est la raison pour laquelle on définira la transition à l'intérieur de l'environnement {\tt umlstate}. Comparez les 2 séquences de codes suivantes :

\medskip

\begin{minipage}{0.51\textwidth}
\lstinputlisting{fig/figure59.tikz}
\end{minipage}
\begin{minipage}{0.49\textwidth}
\begin{center}
\inputTikZ{figure59}
\end{center}
\end{minipage}

\begin{minipage}{0.51\textwidth}
\lstinputlisting{fig/figure60.tikz}
\end{minipage}
\begin{minipage}{0.49\textwidth}
\begin{center}
\inputTikZ{figure60}
\end{center}
\end{minipage}

\section{Personnalisation}\label{s.fitstatetrans}

Grace à la commande {\tt tikzumlset}, on peut modifier globalement les couleurs par défaut des états et transitions :

\begin{description}
\item[text :] permet de spécifier la couleur du texte (=black par défaut),
\item[draw :] permet de spécifier la couleur des traits et des états initiaux, finaux et de jonction (=black par défaut),
\item[fill state :] permet de spécifier la couleur de fond des cas d'utilisation (=yellow!20 par défaut),
\item[font :] permet de spécifier le style de fonte du texte (=$\backslash$small par défaut).
\end{description}

On peut également utiliser les options {\tt text}, {\tt draw} et {\tt fill} sur un élément particulier pour lui modifier ses couleurs, comme illustré dans l'exemple d'introduction.

\section{Exemples}

\subsection{Exemple de l'introduction pas à pas}

\subsubsection{Définition des états standards}

\medskip

\begin{center}
\inputTikZ{figure61}
\end{center}

\newpage

{\color{red!70!black}
\lstinputlisting[firstline=2, lastline=3]{fig/statediagex.tikz}\vspace{-0.37cm}
\lstinputlisting[firstline=5, lastline=5]{fig/statediagex.tikz}\vspace{-0.37cm}
\lstinputlisting[firstline=11, lastline=11]{fig/statediagex.tikz}\vspace{-0.37cm}
\lstinputlisting[firstline=16, lastline=16]{fig/statediagex.tikz}\vspace{-0.37cm}
\lstinputlisting[firstline=21, lastline=21]{fig/statediagex.tikz}\vspace{-0.37cm}
\lstinputlisting[firstline=25, lastline=25]{fig/statediagex.tikz}
}

\vspace{-0.5cm}

\subsubsection{Définition des états spécifiques}

\medskip

\begin{center}
\inputTikZ{figure62}
\end{center}

\medskip

\lstinputlisting[firstline=2, lastline=3]{fig/statediagex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=4, lastline=4]{fig/statediagex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=5, lastline=5]{fig/statediagex.tikz}\vspace{-0.37cm}
\lstinputlisting[firstline=11, lastline=11]{fig/statediagex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=14, lastline=14]{fig/statediagex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=16, lastline=16]{fig/statediagex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=17, lastline=17]{fig/statediagex.tikz}\vspace{-0.37cm}
\lstinputlisting[firstline=19, lastline=19]{fig/statediagex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=21, lastline=21]{fig/statediagex.tikz}\vspace{-0.37cm}
\lstinputlisting[firstline=25, lastline=25]{fig/statediagex.tikz}
\subsubsection{Définition des transitions}

\lstinputlisting[firstline=2, lastline=5]{fig/statediagex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=6, lastline=10]{fig/statediagex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=11, lastline=11]{fig/statediagex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=12, lastline=13]{fig/statediagex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=14, lastline=14]{fig/statediagex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=15, lastline=15]{fig/statediagex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=16, lastline=17]{fig/statediagex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=18, lastline=18]{fig/statediagex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=19, lastline=19]{fig/statediagex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=20, lastline=20]{fig/statediagex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=21, lastline=21]{fig/statediagex.tikz}\vspace{-0.4cm}
{\color{red!70!black}
\lstinputlisting[firstline=22, lastline=24]{fig/statediagex.tikz}\vspace{-0.4cm}
}
\lstinputlisting[firstline=25, lastline=25]{fig/statediagex.tikz}

\begin{center}
\inputTikZ{figure63}
\end{center}

%\section{Règles de priorité des options et bugs identifiés}\label{s.statetransbug}
%
%\chapter{Diagrammes de séquence}\label{c.seq}
%
%\begin{lstlisting}
%\begin{umlseqdiag}
%\umlobj[class=A]{a}
%\umlobj[class=B, x=4]{b}
%\umlobj[class=C, x=8]{c}
%\umlobj[class=D, x=12]{d}
%\begin{umlcall}[op=opa(), type=synchron, return=0, dt=1.5]{a}{b}
%\begin{umlfragment}
%\begin{umlcall}[op=opb(), type=synchron, return=1, dt=0.5]{b}{c}
%\begin{umlfragment}[type=alt, label=condition, inner xsep=1.1]
%\begin{umlcall}[op=opc(), type=asynchron, dt=0.5]{c}{d}
%\end{umlcall}
%\umlfpart[case = 1]
%\begin{umlcall}[op=opd(), type=synchron, return=3, dt=1]{c}{d}
%\end{umlcall}
%\umlfpart[default]
%\begin{umlcall}[op=ope(), name=toto, type=synchron, return=3, dt=1]{c}{d}
%\end{umlcall}
%\end{umlfragment}
%\end{umlcall}
%\end{umlfragment}
%\begin{umlfragment}
%\begin{umlcallself}[op=opf(), type=synchron, return=4, dt=0.5]{b}
%\begin{umlfragment}[type=assert]
%\begin{umlcall}[op=opg(), type=synchron, return=5, dt=0.5]{b}{c}
%\end{umlcall}
%\end{umlfragment}
%\end{umlcallself}
%\end{umlfragment}
%\end{umlcall}
%\end{umlseqdiag}
%\end{lstlisting}
%
%\begin{tikzpicture}
%\begin{umlseqdiag}
%\umlactor[class=A]{a}
%\umldatabase[class=B, fill=blue!20]{b}
%\umlmulti[class=C]{c}
%\umlobject[class=D]{d}
%\begin{umlcall}[op=opa(), type=synchron, return=0]{a}{b}
%\begin{umlfragment}
%\begin{umlcall}[op=opb(),  type=synchron, return=1]{b}{c}
%\begin{umlfragment}[type=alt, label=condition, inner xsep=8, fill=green!10]
%\begin{umlcall}[op=opc(), type=asynchron, fill=red!10]{c}{d}
%\end{umlcall}
%\umlfpart[case = 1]
%\begin{umlcall}[op=opd(), type=synchron, return=3]{c}{d}
%\end{umlcall}
%\umlfpart[default]
%\begin{umlcall}[op=ope(), type=synchron, return=3]{c}{d}
%\end{umlcall}
%\end{umlfragment}
%\end{umlcall}
%\end{umlfragment}
%\begin{umlfragment}
%\begin{umlcallself}[op=opf(), type=synchron, return=4]{b}
%\begin{umlfragment}[type=assert]
%\begin{umlcall}[op=opg(), type=synchron, return=5]{b}{c}
%\end{umlcall}
%\end{umlfragment}
%\end{umlcallself}
%\end{umlfragment}
%\end{umlcall}
%\umlcreatecall[class=E, x=8]{a}{e}
%\begin{umlfragment}
%\begin{umlcall}[op=oph(), name=test, type=synchron, return=6, dt=7, fill=red!10]{a}{e}
%\umlcreatecall[class=F, stereo=boundary, x=12]{e}{f}
%\end{umlcall}
%\begin{umlcall}[op=opi(), type=synchron, return=7]{a}{e}
%\end{umlcall}
%\end{umlfragment}
%
%\end{umlseqdiag}
%\end{tikzpicture}
%
%\section{Les objets}\label{s.objs}
%
%\subsection{Objet}\label{ss.obj}
%
%\subsection{Acteur}\label{ss.actorobj}
%
%\subsection{Base de donnée}\label{ss.database}
%
%\subsection{Frontière}\label{ss.boundary}
%
%\subsection{Contrôle}\label{ss.control}
%
%\subsection{Entité}\label{ss.entity}
%
%\subsection{Collection d'objets}\label{ss.multi}
%
%\section{Appels de fonctions}\label{s.calls}
%
%\subsection{Appels simples}\label{ss.call}
%
%\subsection{Appels récursifs}\label{ss.callself}
%
%\subsection{Création d'objets}\label{ss.create}
%
%\section{Fragments combinés}\label{s.fragments}
%
%\section{Personnalisation}\label{s.fitseq}
%
%\section{Exemples}
%
%\section{Règles de priorité des options et bugs identifiés}\label{s.seqbug}
\end{document}